[gd_scene load_steps=25 format=2]

[ext_resource path="res://Scenes/ItemShopPanel.tscn" type="PackedScene" id=1]
[ext_resource path="res://Sprites/Collectables/Coin.png" type="Texture" id=2]
[ext_resource path="res://Fonts/overload.ttf" type="DynamicFontData" id=3]
[ext_resource path="res://Sprites/Collectables/Fish.png" type="Texture" id=4]
[ext_resource path="res://Sprites/UI/CloseButton.png" type="Texture" id=5]
[ext_resource path="res://Sprites/UI/CloseButtonPressed.png" type="Texture" id=6]
[ext_resource path="res://Scenes/BaseButtonShop.tscn" type="PackedScene" id=7]
[ext_resource path="res://Sprites/UI/Shop/SkinButton.png" type="Texture" id=8]
[ext_resource path="res://Sprites/UI/Shop/ScarfButton.png" type="Texture" id=9]
[ext_resource path="res://Sprites/UI/Shop/JetpackButton.png" type="Texture" id=10]
[ext_resource path="res://Sprites/Shop/Cat/Skin/Grey.png" type="Texture" id=11]
[ext_resource path="res://Sprites/Cat/Jetpack.png" type="Texture" id=12]

[sub_resource type="StyleBoxFlat" id=1]
bg_color = Color( 0.247059, 0, 0.388235, 1 )

[sub_resource type="GDScript" id=2]
script/source = "extends Control

export (PackedScene) var item_shop_panel

func _ready():
	update_currency()
	update_equipment()
	_on_Hat_button_down()
	pass

func update_currency():
	$VBC/HBC/ShopPanel/Currency/CoinPanel/Coins/Label.text = str(GameManager.coins)
	$VBC/HBC/ShopPanel/Currency/FishPanel/Fishes/Label.text = str(GameManager.fishes)
	pass

func _on_Hat_button_down():
	if GameManager.item_data.has('Hat'):
		create_panels(GameManager.item_data['Hat'])
	pass

func _on_Skin_button_down():
	if GameManager.item_data.has('Skin'):
		create_panels(GameManager.item_data['Skin'])
	pass

func _on_Scarf_button_down():
	if GameManager.item_data.has('Scarf'):
		create_panels(GameManager.item_data['Scarf'])
	pass # Replace with function body.

func _on_Jetpack_button_down():
	if GameManager.item_data.has('Jetpack'):
		create_panels(GameManager.item_data['Jetpack'])
	pass # Replace with function body.


func _on_Thruster_button_down():
	if GameManager.item_data.has('Thruster'):
		create_panels(GameManager.item_data['Thruster'])
	pass # Replace with function body.

func clear_item_panels():
	for i in $VBC/HBC/ShopPanel/PanelItems/Items.get_children():
		i.queue_free()
	pass

func create_panels(data : Dictionary):
	clear_item_panels()
	for i in data.keys():
		var isp = item_shop_panel.instance()
		$VBC/HBC/ShopPanel/PanelItems/Items.add_child(isp)
		isp.set_item_info(i,data[i])
	pass

func _on_TextureButton_button_down():
	get_tree().change_scene('Scenes/MainMenu.tscn')
	pass

func enable_last_used_item(type,item_name):
	update_equipment()
	for i in $VBC/HBC/ShopPanel/PanelItems/Items.get_children():
		if i.item_name != item_name:
			i.enable_use_button(true)
	pass

func update_equipment():
	if !GameManager.items_equipped.keys().empty():
		for item in GameManager.items_equipped.keys():
			match item:
				'Hat':
					set_hat(GameManager.items_equipped[item])
				'Skin':
					set_skin(GameManager.items_equipped[item])
				'Scarf':
					set_scarf(GameManager.items_equipped[item])
				'Jetpack':
					set_jetpack(GameManager.items_equipped[item])
				'Thruster':
					set_thruster(GameManager.items_equipped[item])
	pass

func update_buttons_states(type,item):
	for i in $VBC/HBC/ShopPanel/PanelItems/Items.get_children():
		i.check_item_state()

func set_hat(item):
	$VBC/PlayerPanel/HBC/Player/Skin/Hat.texture = load('Sprites/Shop/Cat/Hat/'+item+'.png')

func set_skin(item):
	$VBC/PlayerPanel/HBC/Player/Skin/.texture = load('Sprites/Shop/Cat/Skin/'+item+'.png')

func set_scarf(item):
	$VBC/PlayerPanel/HBC/Player/Skin/Scarf.texture = load('Sprites/Shop/Cat/Scarf/'+item+'.png')

func set_jetpack(item):
	$VBC/PlayerPanel/HBC/Player/Skin/Jetpack.texture = load('Sprites/Shop/Cat/Jetpack/'+item+'.png')

func set_thruster(item):
	#$VBC/PlayerPanel/HBC/Player/Skin/Jetpack.texture = load('Sprites/Shop/Cat/Jetpack/'+item+'.png')
	pass"

[sub_resource type="StyleBoxFlat" id=3]
bg_color = Color( 0.247059, 0, 0.388235, 1 )

[sub_resource type="StyleBoxFlat" id=4]
bg_color = Color( 0.32549, 0, 0.509804, 1 )
border_width_left = 10
border_width_top = 10
border_width_right = 10
border_width_bottom = 10
border_color = Color( 0.180392, 0, 0.286275, 1 )
corner_radius_top_left = 20
corner_radius_top_right = 20
corner_radius_bottom_right = 20
corner_radius_bottom_left = 20

[sub_resource type="DynamicFont" id=5]
size = 80
outline_size = 3
outline_color = Color( 0, 0, 0, 1 )
font_data = ExtResource( 3 )

[sub_resource type="StyleBoxFlat" id=6]
bg_color = Color( 0.32549, 0, 0.509804, 1 )
border_width_left = 10
border_width_top = 10
border_width_right = 10
border_width_bottom = 10
border_color = Color( 0.180392, 0, 0.286275, 1 )
corner_radius_top_left = 20
corner_radius_top_right = 20
corner_radius_bottom_right = 20
corner_radius_bottom_left = 20

[sub_resource type="StyleBoxFlat" id=7]
bg_color = Color( 0.247059, 0, 0.388235, 1 )
border_width_left = 10
border_width_top = 10
border_width_right = 10
border_width_bottom = 10
border_color = Color( 0.180392, 0, 0.286275, 1 )
corner_radius_top_left = 50
corner_radius_top_right = 50
corner_radius_bottom_right = 50
corner_radius_bottom_left = 50

[sub_resource type="StyleBoxFlat" id=8]
bg_color = Color( 0.247059, 0, 0.388235, 1 )
border_width_left = 10
border_width_top = 10
border_width_right = 10
border_width_bottom = 10
border_color = Color( 0.180392, 0, 0.286275, 1 )
corner_radius_top_left = 50
corner_radius_top_right = 50
corner_radius_bottom_right = 50
corner_radius_bottom_left = 50

[sub_resource type="StyleBoxFlat" id=9]
bg_color = Color( 0.247059, 0, 0.388235, 1 )
border_width_left = 10
border_width_top = 10
border_width_right = 10
border_width_bottom = 10
border_color = Color( 0.180392, 0, 0.286275, 1 )
corner_radius_top_left = 50
corner_radius_top_right = 50
corner_radius_bottom_right = 50
corner_radius_bottom_left = 50

[sub_resource type="StyleBoxFlat" id=10]
bg_color = Color( 0.701961, 0.505882, 0.933333, 1 )
border_width_left = 10
border_width_top = 10
border_width_right = 10
border_width_bottom = 10
border_color = Color( 0.505882, 0.32549, 0.721569, 1 )
corner_radius_top_left = 50
corner_radius_top_right = 50
corner_radius_bottom_right = 50
corner_radius_bottom_left = 50

[sub_resource type="StyleBoxFlat" id=11]
bg_color = Color( 0.933333, 0.721569, 0, 1 )
border_width_left = 10
border_width_top = 10
border_width_right = 10
border_width_bottom = 10
border_color = Color( 0.784314, 0.533333, 0, 1 )
corner_radius_top_left = 50
corner_radius_top_right = 50
corner_radius_bottom_right = 50
corner_radius_bottom_left = 50

[sub_resource type="DynamicFont" id=12]
size = 56
outline_size = 5
outline_color = Color( 0, 0, 0, 1 )
use_filter = true
font_data = ExtResource( 3 )

[node name="ShopScene" type="Panel"]
anchor_right = 1.0
anchor_bottom = 1.0
custom_styles/panel = SubResource( 1 )
script = SubResource( 2 )
item_shop_panel = ExtResource( 1 )

[node name="VBC" type="VBoxContainer" parent="."]
editor/display_folded = true
anchor_right = 1.0
anchor_bottom = 1.0
custom_constants/separation = 5

[node name="HBC" type="HBoxContainer" parent="VBC"]
editor/display_folded = true
margin_right = 1080.0
margin_bottom = 1315.0
size_flags_horizontal = 3
size_flags_vertical = 3
custom_constants/separation = 0

[node name="ShopPanel" type="VBoxContainer" parent="VBC/HBC"]
margin_right = 880.0
margin_bottom = 1315.0
mouse_filter = 2
size_flags_horizontal = 3
size_flags_vertical = 3
custom_constants/separation = 0

[node name="Currency" type="Panel" parent="VBC/HBC/ShopPanel"]
editor/display_folded = true
margin_right = 880.0
margin_bottom = 160.0
rect_min_size = Vector2( 0, 160 )
custom_styles/panel = SubResource( 3 )

[node name="CoinPanel" type="Panel" parent="VBC/HBC/ShopPanel/Currency"]
editor/display_folded = true
anchor_top = 0.5
anchor_bottom = 0.5
margin_left = 40.0
margin_top = -60.0
margin_right = 410.0
margin_bottom = 62.0
rect_min_size = Vector2( 370, 0 )
custom_styles/panel = SubResource( 4 )

[node name="Coins" type="TextureRect" parent="VBC/HBC/ShopPanel/Currency/CoinPanel"]
anchor_top = 0.5
anchor_bottom = 0.5
margin_left = 20.0
margin_top = -51.0
margin_right = 110.0
margin_bottom = 52.0
texture = ExtResource( 2 )
expand = true
stretch_mode = 6

[node name="Label" type="Label" parent="VBC/HBC/ShopPanel/Currency/CoinPanel/Coins"]
anchor_left = 1.0
anchor_top = 0.5
anchor_right = 1.0
anchor_bottom = 0.5
margin_left = 10.0
margin_top = -61.0
margin_right = 230.0
margin_bottom = 57.0
custom_fonts/font = SubResource( 5 )
text = "99999"
valign = 1

[node name="FishPanel" type="Panel" parent="VBC/HBC/ShopPanel/Currency"]
editor/display_folded = true
anchor_left = 1.0
anchor_top = 0.5
anchor_right = 1.0
anchor_bottom = 0.5
margin_left = -410.0
margin_top = -59.5
margin_right = -70.0
margin_bottom = 63.5
rect_min_size = Vector2( 370, 0 )
custom_styles/panel = SubResource( 6 )

[node name="Fishes" type="TextureRect" parent="VBC/HBC/ShopPanel/Currency/FishPanel"]
anchor_top = 0.5
anchor_bottom = 0.5
margin_left = 20.0
margin_top = -44.5
margin_right = 110.0
margin_bottom = 45.5
texture = ExtResource( 4 )
expand = true
stretch_mode = 6

[node name="Label" type="Label" parent="VBC/HBC/ShopPanel/Currency/FishPanel/Fishes"]
anchor_left = 1.0
anchor_top = 0.5
anchor_right = 1.0
anchor_bottom = 0.5
margin_left = 8.72821
margin_top = -62.0
margin_right = 228.728
margin_bottom = 58.0
custom_fonts/font = SubResource( 5 )
text = "99999"
valign = 1

[node name="PanelItems" type="Panel" parent="VBC/HBC/ShopPanel"]
margin_top = 160.0
margin_right = 880.0
margin_bottom = 1315.0
mouse_filter = 1
size_flags_horizontal = 3
size_flags_vertical = 3
custom_styles/panel = SubResource( 7 )

[node name="Items" type="GridContainer" parent="VBC/HBC/ShopPanel/PanelItems"]
anchor_right = 1.0
anchor_bottom = 1.0
margin_left = 20.0
margin_top = 20.0
margin_right = -20.0
margin_bottom = -20.0
custom_constants/hseparation = 25
columns = 3

[node name="VBB" type="VBoxContainer" parent="VBC/HBC"]
editor/display_folded = true
margin_left = 880.0
margin_right = 1080.0
margin_bottom = 1315.0

[node name="CloseButton" type="TextureButton" parent="VBC/HBC/VBB"]
margin_right = 200.0
margin_bottom = 160.0
rect_min_size = Vector2( 0, 160 )
texture_normal = ExtResource( 5 )
texture_pressed = ExtResource( 6 )
expand = true
stretch_mode = 5

[node name="PanelButtons" type="Panel" parent="VBC/HBC/VBB"]
margin_top = 164.0
margin_right = 200.0
margin_bottom = 1315.0
rect_min_size = Vector2( 200, 0 )
size_flags_vertical = 3
custom_styles/panel = SubResource( 8 )

[node name="Panel" type="VBoxContainer" parent="VBC/HBC/VBB/PanelButtons"]
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
margin_left = -91.5
margin_top = -442.0
margin_right = 91.5
margin_bottom = 442.0
rect_min_size = Vector2( 170, 0 )
size_flags_horizontal = 3
size_flags_stretch_ratio = 0.3
custom_constants/separation = 50

[node name="Hat" parent="VBC/HBC/VBB/PanelButtons/Panel" instance=ExtResource( 7 )]
margin_right = 183.0
margin_bottom = 183.0
size_flags_horizontal = 3
size_flags_vertical = 3

[node name="Skin" parent="VBC/HBC/VBB/PanelButtons/Panel" instance=ExtResource( 7 )]
margin_top = 233.0
margin_right = 183.0
margin_bottom = 416.0
size_flags_horizontal = 3
size_flags_vertical = 3

[node name="Type" parent="VBC/HBC/VBB/PanelButtons/Panel/Skin" index="0"]
texture = ExtResource( 8 )

[node name="Scarf" parent="VBC/HBC/VBB/PanelButtons/Panel" instance=ExtResource( 7 )]
margin_top = 466.0
margin_right = 183.0
margin_bottom = 649.0
size_flags_horizontal = 3
size_flags_vertical = 3

[node name="Type" parent="VBC/HBC/VBB/PanelButtons/Panel/Scarf" index="0"]
texture = ExtResource( 9 )

[node name="Jetpack" parent="VBC/HBC/VBB/PanelButtons/Panel" instance=ExtResource( 7 )]
margin_top = 699.0
margin_right = 183.0
margin_bottom = 884.0
size_flags_horizontal = 3
size_flags_vertical = 3

[node name="Type" parent="VBC/HBC/VBB/PanelButtons/Panel/Jetpack" index="0"]
texture = ExtResource( 10 )

[node name="Thruster" parent="VBC/HBC/VBB/PanelButtons/Panel" instance=ExtResource( 7 )]
editor/display_folded = true
visible = false
margin_top = 752.0
margin_right = 170.0
margin_bottom = 920.0
size_flags_horizontal = 3
size_flags_vertical = 3

[node name="PlayerPanel" type="Panel" parent="VBC"]
editor/display_folded = true
margin_top = 1320.0
margin_right = 1080.0
margin_bottom = 1920.0
rect_min_size = Vector2( 0, 600 )
custom_styles/panel = SubResource( 9 )

[node name="HBC" type="HBoxContainer" parent="VBC/PlayerPanel"]
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
margin_left = -460.0
margin_top = -283.0
margin_right = 460.0
margin_bottom = 277.0
size_flags_horizontal = 3
size_flags_vertical = 3
custom_constants/separation = 10

[node name="Player" type="Panel" parent="VBC/PlayerPanel/HBC"]
editor/display_folded = true
margin_right = 455.0
margin_bottom = 560.0
size_flags_horizontal = 3
size_flags_vertical = 3
custom_styles/panel = SubResource( 10 )

[node name="Skin" type="TextureRect" parent="VBC/PlayerPanel/HBC/Player"]
editor/display_folded = true
anchor_left = 0.5
anchor_top = 1.0
anchor_right = 0.5
anchor_bottom = 1.0
margin_left = -150.0
margin_top = -450.0
margin_right = 150.0
margin_bottom = -34.0
rect_min_size = Vector2( 300, 0 )
size_flags_horizontal = 3
size_flags_vertical = 3
texture = ExtResource( 11 )
expand = true
stretch_mode = 6

[node name="Hat" type="TextureRect" parent="VBC/PlayerPanel/HBC/Player/Skin"]
anchor_left = 0.5
anchor_right = 0.5
margin_left = -148.0
margin_top = -113.0
margin_right = 150.0
margin_bottom = 92.0
expand = true
stretch_mode = 6

[node name="Scarf" type="TextureRect" parent="VBC/PlayerPanel/HBC/Player/Skin"]
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
margin_left = -80.0
margin_top = -20.0
margin_right = 70.0
margin_bottom = 140.0
expand = true
stretch_mode = 6

[node name="Jetpack" type="TextureRect" parent="VBC/PlayerPanel/HBC/Player/Skin"]
show_behind_parent = true
margin_left = 49.5
margin_top = 180.0
margin_right = 272.5
margin_bottom = 403.0
texture = ExtResource( 12 )
expand = true
stretch_mode = 6

[node name="Stats" type="Panel" parent="VBC/PlayerPanel/HBC"]
editor/display_folded = true
margin_left = 465.0
margin_right = 920.0
margin_bottom = 560.0
size_flags_horizontal = 3
size_flags_vertical = 3
custom_styles/panel = SubResource( 11 )

[node name="Title" type="Label" parent="VBC/PlayerPanel/HBC/Stats"]
anchor_left = 0.5
anchor_right = 0.5
margin_left = -114.0
margin_top = 50.0
margin_right = 114.0
margin_bottom = 118.0
custom_fonts/font = SubResource( 12 )
text = "BONUS"
align = 1

[connection signal="button_down" from="VBC/HBC/VBB/CloseButton" to="." method="_on_TextureButton_button_down"]
[connection signal="button_down" from="VBC/HBC/VBB/PanelButtons/Panel/Hat" to="." method="_on_Hat_button_down"]
[connection signal="button_down" from="VBC/HBC/VBB/PanelButtons/Panel/Skin" to="." method="_on_Skin_button_down"]
[connection signal="button_down" from="VBC/HBC/VBB/PanelButtons/Panel/Scarf" to="." method="_on_Scarf_button_down"]
[connection signal="button_down" from="VBC/HBC/VBB/PanelButtons/Panel/Jetpack" to="." method="_on_Jetpack_button_down"]
[connection signal="button_down" from="VBC/HBC/VBB/PanelButtons/Panel/Thruster" to="." method="_on_Thruster_button_down"]

[editable path="VBC/HBC/VBB/PanelButtons/Panel/Hat"]

[editable path="VBC/HBC/VBB/PanelButtons/Panel/Skin"]

[editable path="VBC/HBC/VBB/PanelButtons/Panel/Scarf"]

[editable path="VBC/HBC/VBB/PanelButtons/Panel/Jetpack"]
